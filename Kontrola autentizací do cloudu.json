{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "8d18a888-2526-48e7-b70b-c5e8ee3f6ed0",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "value": "/subscriptions/b6a16c17-756e-4a65-8a04-a1791238d9a9",
            "typeSettings": {
              "additionalResourceOptions": [],
              "includeAll": false
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "3a9a1398-c461-45d7-8bc7-bae0b9473d47",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "value": "/subscriptions/b6a16c17-756e-4a65-8a04-a1791238d9a9/resourceGroups/RG_Sentinel/providers/Microsoft.OperationalInsights/workspaces/wks-sentinel-we",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "2f6d3f3a-3fbd-4a57-b051-9c48deb3907e",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            }
          },
          {
            "id": "fbb099b8-1235-453b-a765-7d8aef4015e8",
            "version": "KqlParameterItem/1.0",
            "name": "TypeOfAccount",
            "label": "Typ účtu",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "IdentityInfo\r\n| join kind=innerunique (\r\n    SigninLogs | distinct UserPrincipalName\r\n) on $left.AccountUPN == $right.UserPrincipalName\r\n| distinct UserType",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "all",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "7546fce4-4372-43a4-b6f9-a1c225a4d07c",
            "version": "KqlParameterItem/1.0",
            "name": "Department",
            "label": "Oddělení",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "//department\r\nIdentityInfo\r\n| join kind=innerunique (\r\n    SigninLogs | distinct UserPrincipalName\r\n) on $left.AccountUPN == $right.UserPrincipalName\r\n| summarize arg_max(TimeGenerated,*) by AccountUPN\r\n| summarize count() by department = CompanyName\r\n| distinct department\r\n| sort by department asc",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "all",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "37f785ec-d21a-4b80-9306-c79e3b0ae415",
            "version": "KqlParameterItem/1.0",
            "name": "FirstCharFromUPN",
            "label": "První znak z UPN",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "IdentityInfo\r\n| join kind=innerunique (\r\n    SigninLogs | distinct UserPrincipalName\r\n) on $left.AccountUPN == $right.UserPrincipalName\r\n| project-away UserPrincipalName\r\n| extend FirstChar = tolower(substring(AccountUPN,0,1))\r\n| where UserType in({TypeOfAccount:value}) or \"all\" in({TypeOfAccount:value})\r\n| where CompanyName in({Department:value}) or \"all\" in({Department:value})\r\n| distinct FirstChar\r\n| sort by FirstChar asc",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "all",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "98be2db0-1af1-456c-b135-202a3dc8a307",
            "version": "KqlParameterItem/1.0",
            "name": "userPrincipalName",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "\"",
            "delimiter": ",",
            "query": "IdentityInfo\r\n| where UserType in({TypeOfAccount:value}) or \"all\" in({TypeOfAccount:value})\r\n| where CompanyName in({Department:value}) or \"all\" in({Department:value})\r\n| extend FirstChar = tolower(substring(AccountUPN,0,1))\r\n| where FirstChar in({FirstCharFromUPN:value}) or \"all\" in({FirstCharFromUPN:value})\r\n| project-rename userPrincipalName = AccountUPN\r\n| distinct userPrincipalName\r\n| sort by userPrincipalName asc\r\n| join kind=innerunique (\r\n    SigninLogs | distinct UserPrincipalName\r\n) on $left.userPrincipalName == $right.UserPrincipalName\r\n| project-away UserPrincipalName",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "c43ceac8-6ec4-42cf-8ce7-2276b1520513",
            "version": "KqlParameterItem/1.0",
            "name": "SearchUPN",
            "type": 1,
            "timeContext": {
              "durationMs": 2592000000
            },
            "value": ""
          },
          {
            "id": "a63d64b3-3d64-4261-897b-e5dcb0ec1c29",
            "version": "KqlParameterItem/1.0",
            "name": "param_SearchBarOverride",
            "type": 1,
            "query": "let choice = iff(isnotempty(\"{SearchUPN:value}\"),'| where AccountUPN contains \"{SearchUPN:value}\"',  \r\niff(\"All\" in(\"{userPrincipalName:label}\"),\"//\",'| where AccountUPN in({userPrincipalName})'\r\n));\r\nprint choice",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 2592000000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "caea5b28-7779-4e41-ae04-444e1240531b",
            "version": "KqlParameterItem/1.0",
            "name": "AuditTracker",
            "type": 1,
            "query": "print \"TLP:Strict; WorkbookName:Kontrola autentizací do cloudu v rámci SignIn Logu Azure AD\"",
            "isHiddenWhenLocked": true,
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 3"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "5ef57a45-0ef6-42cd-a3f7-f9ef7235233c",
            "version": "KqlParameterItem/1.0",
            "name": "DetailSearchUPNValue",
            "label": "Filtruj vyhledané identity",
            "type": 2,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "IdentityInfo\r\n{param_SearchBarOverride:value}\r\n| distinct AccountUPN\r\n| sort by AccountUPN asc",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "@",
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 2592000000
            },
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "4cf0a64e-ee21-4ac5-9663-53412ed876af",
            "version": "KqlParameterItem/1.0",
            "name": "SelectedUsersWithExcludeFilter",
            "type": 1,
            "query": "let choice = iff(\"@\" in({DetailSearchUPNValue:value}), '{param_SearchBarOverride}', \r\n\t\t\t iff(\"@\" !in({DetailSearchUPNValue:value}), \"| where AccountUPN in({DetailSearchUPNValue:value})\",\r\n\t\t\t '{param_SearchBarOverride}'));\r\nprint choice",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 2592000000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "conditionalVisibility": {
        "parameterName": "SearchUPN",
        "comparison": "isNotEqualTo"
      },
      "name": "parameters - 7"
    },
    {
      "type": 1,
      "content": {
        "json": "### Pozor ve filtru zůstala nastavena hodnota exlude, ve které se nacházejí hodnoty {DetailSearchUPNValue:value}",
        "style": "warning"
      },
      "conditionalVisibility": {
        "parameterName": "DetailSearchUPNValue",
        "comparison": "isNotEqualTo",
        "value": "'@'"
      },
      "name": "text - 8"
    },
    {
      "type": 1,
      "content": {
        "json": "## Kontrola autentizací do cloudu v rámci SignIn Logu Azure AD\n---\n\n"
      },
      "name": "text - 2"
    },
    {
      "type": 1,
      "content": {
        "json": "<br>\r\n<br>\r\n<img width=500 src='https://www.cyber-rangers.com/assets/gfx/logo.svg'/>"
      },
      "customWidth": "40",
      "name": "text - 2"
    },
    {
      "type": 1,
      "content": {
        "json": "<br><br>\r\n#### Tento report poskytuje informace o uživatelích a jejich autentizacích. Využití reportu je určeno oddělení bezpečnosti, který na základě nastaveného filtru provede triage uživatele a na základě získaných informací provede posouzení o škodlivosti aktivit, které uživatel v prostředí vykonával. Celkový report zobrazuje stav nad všemi účty konkrétní identity uživatele. Data zobrazená v reportu jsou vázána pouze na cloud ekosystem společnosti Microsoft."
      },
      "customWidth": "40",
      "name": "text - 4"
    },
    {
      "type": 1,
      "content": {
        "json": "---\r\nVýběr můžete provést buď na zemi, kde byl proveden pokus o autentizaci, čímž se vám níže uvedené tabulky profiltrují tak, že se zobrazí jen informace o uživatelích, u kterých došlo k autentizaci v daném státě a nebo přímo výběrem identitity z levé tabulky (tabulka všech autentizací). Tím se vám zobrazí detailní informace o dané identitě. Kliknutím na detail info nebo device info můžete zobrazit informace o uživateli z logu IdentitityInfo a nebo si můžete zobrazit i detail o zařízení, ze kterého byl realizován pokus o autentizaci. Na pravé straně v bude zobrazen graf autentizací v čase a níže bude zobrazena přehledová tabulka přihlášení vybrané identity. Reset zpět je možné provést stiskem zpětné šipky nad levou tabulkou.",
        "style": "info"
      },
      "name": "text - 5"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let CountryCode = externaldata (\r\n    name:string,alpha2:string,alpha3:string,countrycode:int,iso31662:string,region:string,subregion:string,intermediateregion:string,regioncode:int,subregioncode:int,intermediateregioncode:int)[@\"https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv\"];\r\nSigninLogs\r\n| extend AccountUPN = UserPrincipalName\r\n| extend userPrincipalName = UserPrincipalName\r\n| extend Result = iff(ResultType == 0, \"Success\", \"Failed\")\r\n{SelectedUsersWithExcludeFilter:value}\r\n| summarize count(), SuccessCount = countif(Result == \"Success\"), FailedCount = countif(Result == \"Failed\") by Location\r\n| extend AuthStatus = strcat(\"Success:\", SuccessCount, \", Failed:\", FailedCount)\r\n| join kind=leftouter (\r\n    CountryCode | distinct name, alpha2, region\r\n) on $left.Location == $right.alpha2",
        "size": 3,
        "title": "Lokace, ze kterých dle Microsoftu došlo k přihlášení do cloudu",
        "timeContextFromParameter": "TimeRange",
        "exportFieldName": "Location",
        "exportParameterName": "export_Location",
        "exportDefaultValue": "all",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "name",
            "formatter": 1
          },
          "subtitleContent": {
            "columnMatch": "region"
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          },
          "secondaryContent": {
            "columnMatch": "AuthStatus"
          },
          "showBorder": true
        }
      },
      "customWidth": "90",
      "name": "query - 11"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "17acf4fb-0a85-4c43-8ee7-7fabf2272f95",
            "version": "KqlParameterItem/1.0",
            "name": "LocationFilter",
            "type": 1,
            "query": "let choice = iff(\"all\" in(\"{export_Location}\"), \"//\", '| where Location in (\"{export_Location}\")');\r\nprint choice \r\n",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 2592000000
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "10",
      "name": "parameters - 12"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "//State\r\nSigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n{LocationFilter}\r\n| summarize count(),  SuccessLogon = countif(ResultType == 0), FailedLogon = countif(ResultType != 0) by Location, state = tostring(LocationDetails.state)\r\n| extend AuthStatus = strcat(\"Success:\", SuccessLogon, \", Failed:\", FailedLogon)",
        "size": 3,
        "title": "Vyberte si kraj nebo stát (state) nebo ponechte nevybráno",
        "timeContextFromParameter": "TimeRange",
        "exportFieldName": "state",
        "exportParameterName": "export_state",
        "exportDefaultValue": "all",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "state",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "secondaryContent": {
            "columnMatch": "AuthStatus"
          },
          "showBorder": false
        }
      },
      "conditionalVisibility": {
        "parameterName": "export_Location",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "customWidth": "90",
      "name": "query - 19"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "237c4648-5c68-47c5-b82f-417627611c74",
            "version": "KqlParameterItem/1.0",
            "name": "StateFilter",
            "type": 1,
            "query": "let choice = iff(\"all\" in (\"{export_state}\"), \"//\", '| where LocationDetails.state == \"{export_state}\"');\r\nprint choice",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 86400000
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "10",
      "name": "parameters - 21"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "//city\r\nSigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n{LocationFilter}\r\n{StateFilter}\r\n| summarize count(), SuccessLogon = countif(ResultType == 0), FailedLogon = countif(ResultType != 0) by Location, City = tostring(LocationDetails.city), state = tostring(LocationDetails.state)\r\n| extend AuthStatus = strcat(\"Success:\", SuccessLogon, \", Failed:\", FailedLogon)",
        "size": 3,
        "title": "Vyberte si město nebo jeho část (city) nebo ponechte nevybráno",
        "timeContextFromParameter": "TimeRange",
        "exportFieldName": "City",
        "exportParameterName": "export_city",
        "exportDefaultValue": "all",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "City",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "secondaryContent": {
            "columnMatch": "AuthStatus"
          },
          "showBorder": false
        }
      },
      "conditionalVisibilities": [
        {
          "parameterName": "export_state",
          "comparison": "isNotEqualTo",
          "value": "all"
        },
        {
          "parameterName": "export_Location",
          "comparison": "isNotEqualTo",
          "value": "all"
        }
      ],
      "customWidth": "90",
      "name": "query - 20"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "6f464273-557c-467a-972f-f7a44eee2442",
            "version": "KqlParameterItem/1.0",
            "name": "CityFilter",
            "type": 1,
            "query": "let choice = iff(\"all\" in (\"{export_city}\"), \"//\", '| where LocationDetails.city == \"{export_city}\"');\r\nprint choice",
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "10",
      "name": "parameters - 22"
    },
    {
      "type": 1,
      "content": {
        "json": ""
      },
      "name": "text - 25"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let tempTable = datatable(userPrincipalName:string, Result:string)[\r\n\"temporary@email.com\", \"Success\",\r\n\"temporary@email.com\", \"Failed\"\r\n];\r\nlet LocationFilter = SigninLogs\r\n{LocationFilter} {StateFilter} {CityFilter} \r\n| distinct UserPrincipalName;\r\nlet tb_UserLocation = SigninLogs\r\n| where UserPrincipalName in(LocationFilter)\r\n| summarize make_set(Location) by UserPrincipalName;\r\nSigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| extend AccountUPN = UserPrincipalName\r\n| extend userPrincipalName = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where UserPrincipalName in(LocationFilter)\r\n| extend Result = iff(ResultType == 0, \"Success\", \"Failed\")\r\n| summarize count() by userPrincipalName, Result\r\n| union tempTable\r\n| evaluate pivot(Result, sum(count_))\r\n| extend FailedPercent = toreal(Failed) / (toreal(Failed) + toreal(Success))\r\n| where userPrincipalName != \"temporary@email.com\"\r\n| join kind=leftouter(\r\n    IdentityInfo\r\n    | summarize arg_max(TimeGenerated,*) by AccountUPN\r\n        {SelectedUsersWithExcludeFilter:value}\r\n        | extend AccountEnableIcons = iff(IsAccountEnabled == \"true\", \"✔️\", \"❌\")\r\n        | extend InformationAboutUser = strcat(\r\n            \"Account Enabled: \", AccountEnableIcons, \" \", IsAccountEnabled,\" \\n\",\r\n            \"Display Name: \", AccountDisplayName,\" \\n\",\r\n            \"Mail: \", MailAddress,\" \\n\",\r\n            \"Job Title: \", JobTitle,\" \\n\",\r\n            \"Department: \", Department,\" \\n\",\r\n            \"EmployeeId: \", EmployeeId,\" \\n\",\r\n            \"Company Name: \", CompanyName, \" \\n\",\r\n            \"ChangeSource: \", ChangeSource, \" \\n\",\r\n            \"Phone: \", Phone, \" \\n\"\r\n        )\r\n    | project InformationAboutUser, AccountUPN\r\n) on $left.userPrincipalName == $right.AccountUPN\r\n| join kind=leftouter(\r\n    tb_UserLocation\r\n) on $left.userPrincipalName == $right.UserPrincipalName\r\n| project-rename Location = set_Location\r\n| project-away AccountUPN, UserPrincipalName\r\n| project-reorder userPrincipalName, Location, Failed, Success, FailedPercent\r\n| sort by Failed desc\r\n",
        "size": 0,
        "showAnalytics": true,
        "title": "Vybrané entity",
        "noDataMessage": "Nebyl vybrán správný filtr",
        "noDataMessageStyle": 5,
        "timeContextFromParameter": "TimeRange",
        "exportFieldName": "userPrincipalName",
        "exportParameterName": "export_userPrincipalName",
        "exportDefaultValue": "all",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "userPrincipalName",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "33ch"
              }
            },
            {
              "columnMatch": "Location",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20ch"
              }
            },
            {
              "columnMatch": "Failed",
              "formatter": 4,
              "formatOptions": {
                "palette": "red",
                "customColumnWidthSetting": "100px"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Success",
              "formatter": 4,
              "formatOptions": {
                "palette": "green",
                "customColumnWidthSetting": "100px"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "FailedPercent",
              "formatter": 8,
              "formatOptions": {
                "palette": "greenRed",
                "customColumnWidthSetting": "19.1429ch"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "style": "percent"
                }
              }
            },
            {
              "columnMatch": "InformationAboutUser",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkLabel": "Detail Info",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "23ch"
              }
            },
            {
              "columnMatch": "Locations",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20.7143ch"
              }
            }
          ],
          "rowLimit": 10000,
          "filter": true,
          "sortBy": [
            {
              "itemKey": "userPrincipalName",
              "sortOrder": 1
            }
          ],
          "labelSettings": [
            {
              "columnId": "InformationAboutUser",
              "label": "Detail"
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "userPrincipalName",
            "sortOrder": 1
          }
        ]
      },
      "customWidth": "50",
      "name": "query - 6"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "fb1d8eaa-dc50-4abd-b20a-2d3eb1474958",
            "version": "KqlParameterItem/1.0",
            "name": "selected_userPrincipalNameFromTable1",
            "type": 1,
            "query": "let choice = iff(\"all\" in (\"{export_userPrincipalName:value}\"),\"| where isnotempty(userPrincipalName)\",'| where userPrincipalName in(\"{export_userPrincipalName:value}\")');\r\nprint choice",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "e1cc6ddc-3e78-4a5a-91ca-478deb7c47b4",
            "version": "KqlParameterItem/1.0",
            "name": "Threshold_Signin",
            "type": 1,
            "query": "SigninLogs\r\n| extend userPrincipalName = UserPrincipalName\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n{selected_userPrincipalNameFromTable1:value}\r\n| extend Result = iff(ResultType == 0, \"Success\", \"Failed\")\r\n| summarize count() by bin(TimeGenerated, {TimeRange:grain})\r\n| summarize Threshold = avg(count_)",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "isHiddenWhenLocked": true,
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "customWidth": "5",
      "name": "parameters - 11"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let LocationFilter = SigninLogs\r\n{LocationFilter} {StateFilter} {CityFilter} \r\n| distinct UserPrincipalName;\r\nSigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| extend userPrincipalName = UserPrincipalName\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where UserPrincipalName in(LocationFilter)\r\n{selected_userPrincipalNameFromTable1:value}\r\n| extend Result = iff(ResultType == 0, \"Success\", \"Failed\")\r\n| summarize count() by Result, bin(TimeGenerated, {TimeRange:grain})",
        "size": 0,
        "showAnalytics": true,
        "title": "Autentizace uživatelů v čase",
        "noDataMessage": "Nebyl zvolen správný filtr",
        "noDataMessageStyle": 5,
        "timeContextFromParameter": "TimeRange",
        "showRefreshButton": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart",
        "chartSettings": {
          "showLegend": true,
          "seriesLabelSettings": [
            {
              "seriesName": "Success",
              "label": "Úspěšné přihlášení",
              "color": "green"
            },
            {
              "seriesName": "Failed",
              "label": "Neúspěšné přihlášení",
              "color": "redBright"
            }
          ],
          "customThresholdLine": "{Threshold_Signin}",
          "customThresholdLineStyle": 5
        }
      },
      "customWidth": "45",
      "name": "query - 9"
    },
    {
      "type": 1,
      "content": {
        "json": "## Ve filtru níže se nachází pouze identita {export_userPrincipalName}",
        "style": "info"
      },
      "conditionalVisibility": {
        "parameterName": "export_userPrincipalName",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "name": "text - 13"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")\r\n| extend Result = iff(ResultType == 0, \"Success\", \"Failed\")\r\n| extend City = tostring(LocationDetails.city)\r\n| extend State = tostring(LocationDetails.state)\r\n| extend DeviceDetailBrowser = tostring(DeviceDetail.browser)\r\n| extend DeviceDetailOperatingSystem = tostring(DeviceDetail.operatingSystem)\r\n| project TimeGenerated, Result, ConditionalAccessStatus, Location,City, State, IsInteractive, IPAddress, ResourceDisplayName, AppDisplayName, ClientAppUsed\r\n, UserAgent, DeviceDetailBrowser, DeviceDetailOperatingSystem\r\n| extend DeviceInfoDetail = strcat(\r\n\"ClientAppUsed: \", ClientAppUsed,\" \\n\",\" \\n\",\r\n\"UserAgent: \", UserAgent,\" \\n\",\" \\n\",\r\n\"DeviceDetailBrowser: \", DeviceDetailBrowser,\" \\n\",\" \\n\",\r\n\"DeviceDetailOperatingSystem: \", DeviceDetailOperatingSystem,\" \\n\",\" \\n\"\r\n)",
        "size": 2,
        "title": "Detailní informace o přihlášeních daného uživatele do cloudu",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TimeGenerated",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "34ch"
              }
            },
            {
              "columnMatch": "Result",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Success",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Failed",
                    "representation": "failed",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "unknown",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "15.5ch"
              }
            },
            {
              "columnMatch": "ConditionalAccessStatus",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "success",
                    "representation": "success",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "failure",
                    "representation": "failed",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "notApplied",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "18.5ch"
              }
            },
            {
              "columnMatch": "Location",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "14ch"
              }
            },
            {
              "columnMatch": "City",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "15ch"
              }
            },
            {
              "columnMatch": "State",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "22ch"
              }
            },
            {
              "columnMatch": "IsInteractive",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "true",
                    "representation": "Sev4",
                    "text": "true"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "false",
                    "representation": "Sev2",
                    "text": "false"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev4",
                    "text": "other"
                  }
                ],
                "customColumnWidthSetting": "19.5ch"
              }
            },
            {
              "columnMatch": "IPAddress",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "19ch"
              }
            },
            {
              "columnMatch": "ResourceDisplayName",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "34ch"
              }
            },
            {
              "columnMatch": "AppDisplayName",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "48ch"
              }
            },
            {
              "columnMatch": "ClientAppUsed",
              "formatter": 5,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            },
            {
              "columnMatch": "UserAgent",
              "formatter": 5
            },
            {
              "columnMatch": "DeviceDetailBrowser",
              "formatter": 5
            },
            {
              "columnMatch": "DeviceDetailOperatingSystem",
              "formatter": 5
            },
            {
              "columnMatch": "DeviceInfoDetail",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "Device Info",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "19ch"
              }
            },
            {
              "columnMatch": "DeviceInfo",
              "formatter": 5,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true
              }
            }
          ],
          "rowLimit": 1000,
          "filter": true,
          "sortBy": [
            {
              "itemKey": "TimeGenerated",
              "sortOrder": 1
            }
          ],
          "labelSettings": [
            {
              "columnId": "ConditionalAccessStatus",
              "label": "CA Status"
            },
            {
              "columnId": "IsInteractive",
              "label": "Interactive"
            },
            {
              "columnId": "IPAddress",
              "label": "IP Address"
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "TimeGenerated",
            "sortOrder": 1
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "export_userPrincipalName",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "name": "query - 10"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| extend AccountUPN = UserPrincipalName\r\n| extend userPrincipalName = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")\r\n{LocationFilter} {StateFilter} {CityFilter} \r\n| where ResultType == 0\r\n| extend latitude = toreal(LocationDetails.geoCoordinates.latitude)\r\n| extend longitude = toreal(LocationDetails.geoCoordinates.longitude)\r\n| extend City = tostring(LocationDetails.city)\r\n| extend State = tostring(LocationDetails.state)\r\n| project TimeGenerated, latitude, longitude, Location, City, State\r\n| sort by TimeGenerated asc \r\n| serialize previous_latitude = toreal(prev(latitude))\r\n| serialize previous_longitude = toreal(prev(longitude))\r\n| serialize previous_location = tostring(prev(Location))\r\n| serialize previous_city = tostring(prev(City))\r\n| serialize previous_state = tostring(prev(State))\r\n| serialize previous_timegenerated = todatetime(prev(TimeGenerated))\r\n| extend distance_in_meters = round(geo_distance_2points(previous_latitude,previous_longitude,latitude,longitude),1)\r\n| where distance_in_meters != 0\r\n| extend diff_timegenerated_in_timespan = TimeGenerated - previous_timegenerated\r\n| project-away latitude, longitude, previous_latitude, previous_longitude\r\n| extend diff_timegenerated_in_timespan_seconds = toreal(diff_timegenerated_in_timespan /1s)\r\n| extend Speed_InKMperH = round((distance_in_meters / diff_timegenerated_in_timespan_seconds) * 3.6,1)\r\n| project-away diff_timegenerated_in_timespan_seconds\r\n| extend distance_in_meters = round((distance_in_meters / 1000),2)\r\n| project-reorder TimeGenerated, previous_timegenerated, diff_timegenerated_in_timespan, Location, State, City, previous_location, previous_state, previous_city, distance_in_meters, Speed_InKMperH\r\n",
        "size": 0,
        "title": "Vzdálenost v kilometrech v závislosti na místech úspěšného přihlášení",
        "noDataMessage": "U uživatele nebyly zjištěny anomálie v délce a vzdálenosti úspěšného přihlášení do cloudu",
        "noDataMessageStyle": 3,
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "TimeGenerated",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "27.7143ch"
              }
            },
            {
              "columnMatch": "previous_timegenerated",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "26.2857ch"
              }
            },
            {
              "columnMatch": "diff_timegenerated_in_timespan",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20.8571ch"
              },
              "numberFormat": {
                "unit": 26,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Location",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "19ch"
              }
            },
            {
              "columnMatch": "State",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "26ch"
              }
            },
            {
              "columnMatch": "City",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20ch"
              }
            },
            {
              "columnMatch": "previous_location",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "21ch"
              }
            },
            {
              "columnMatch": "previous_state",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "26ch"
              }
            },
            {
              "columnMatch": "previous_city",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20ch"
              }
            },
            {
              "columnMatch": "distance_in_meters",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Blank",
                    "text": "{0}{1} km"
                  }
                ],
                "customColumnWidthSetting": "18.5ch"
              }
            },
            {
              "columnMatch": "Speed_InKMperH",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "50",
                    "representation": "1",
                    "text": "{0}{1} km/h"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "100",
                    "representation": "2",
                    "text": "{0}{1} km/h"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "100",
                    "representation": "4",
                    "text": "{0}{1} km/h"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "unknown",
                    "text": "{0}{1} km/h"
                  }
                ],
                "customColumnWidthSetting": "23.5ch"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ],
          "rowLimit": 1000,
          "filter": true,
          "labelSettings": [
            {
              "columnId": "TimeGenerated",
              "label": "Čas"
            },
            {
              "columnId": "previous_timegenerated",
              "label": "Čas předchozí"
            },
            {
              "columnId": "diff_timegenerated_in_timespan",
              "label": "Rozdíl času mezi"
            },
            {
              "columnId": "Location",
              "label": "Původní místo"
            },
            {
              "columnId": "State",
              "label": "Stát"
            },
            {
              "columnId": "City",
              "label": "Město"
            },
            {
              "columnId": "previous_location",
              "label": "Předchozí místo"
            },
            {
              "columnId": "previous_state",
              "label": "Předhcozí stát"
            },
            {
              "columnId": "previous_city",
              "label": "Předchozí město"
            },
            {
              "columnId": "distance_in_meters",
              "label": "Vzdálenost"
            },
            {
              "columnId": "Speed_InKMperH",
              "label": "Rychlost v km/h"
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "export_userPrincipalName",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "name": "query - 25"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let data = SigninLogs\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")\r\n| extend errorCode = Status.errorCode\r\n| extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\");\r\nlet appData = data\r\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \"Success\"), FailureCount = countif(SigninStatus == \"Failure\"), InterruptCount = countif(SigninStatus == \"Pending user action\") by Os = tostring(DeviceDetail.operatingSystem)\r\n| where Os != ''\r\n| join kind=inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Os = tostring(DeviceDetail.operatingSystem)\r\n    | project-away TimeGenerated) on Os\r\n| order by TotalCount desc, Os asc\r\n| project Os, TotalCount, SuccessCount, FailureCount, InterruptCount, Trend\r\n| serialize Id = row_number();\r\ndata\r\n| summarize TotalCount = count(), SuccessCount = countif(SigninStatus == \"Success\"), FailureCount = countif(SigninStatus == \"Failure\"), InterruptCount = countif(SigninStatus == \"Pending user action\") by Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\r\n| join kind=inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated in range({TimeRange:start}, {TimeRange:end}, {TimeRange:grain}) by Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\r\n    | project-away TimeGenerated) on Os, Browser\r\n| order by TotalCount desc, Os asc\r\n| project Os, Browser, TotalCount, SuccessCount, FailureCount, InterruptCount, Trend\r\n| serialize Id = row_number(1000000)\r\n| join kind=inner (appData) on Os\r\n| project Id, Name = Browser, Type = 'Browser', ['Sign-in Count'] = TotalCount, Trend, ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = Id1\r\n| union (appData \r\n    | project Id, Name = Os, Type = 'Operating System', ['Sign-in Count'] = TotalCount, Trend, ['Failure Count'] = FailureCount, ['Interrupt Count'] = InterruptCount, ['Success Rate'] = 1.0 * SuccessCount / TotalCount, ParentId = -1)\r\n| order by ['Sign-in Count'] desc, Name asc",
        "size": 3,
        "title": "Zařízení ze kterých se uživatel přihlašoval",
        "timeContextFromParameter": "TimeRange",
        "exportParameterName": "DeviceDetail",
        "exportDefaultValue": "{ \"Name\":\"\", \"Type\":\"*\"}",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Id",
              "formatter": 5
            },
            {
              "columnMatch": "Type",
              "formatter": 5
            },
            {
              "columnMatch": "Sign-in Count",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "Trend",
              "formatter": 9,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "Failure Count|Interrupt Count",
              "formatter": 8,
              "formatOptions": {
                "palette": "orange"
              }
            },
            {
              "columnMatch": "Success Rate",
              "formatter": 5
            },
            {
              "columnMatch": "ParentId",
              "formatter": 5
            }
          ],
          "filter": true,
          "hierarchySettings": {
            "idColumn": "Id",
            "parentColumn": "ParentId",
            "treeType": 0,
            "expanderColumn": "Name"
          }
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "export_userPrincipalName",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "customWidth": "50",
      "name": "query - 24"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let details = dynamic({DeviceDetail});\r\nlet data = SigninLogs\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")\r\n| extend errorCode = Status.errorCode\r\n| extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\")\r\n| extend Os = tostring(DeviceDetail.operatingSystem), Browser = tostring(DeviceDetail.browser)\r\n| where details.Type == '*' or (details.Type == 'Operating System' and Os == details.Name) or (details.Type == 'Browser' and Browser == details.Name);\r\ndata\r\n| order by TimeGenerated desc\r\n| top 200 by TimeGenerated desc\r\n| extend TimeFromNow = now() - TimeGenerated\r\n| extend TimeAgo = strcat(case(TimeFromNow < 2m, strcat(toint(TimeFromNow / 1m), ' seconds'), TimeFromNow < 2h, strcat(toint(TimeFromNow / 1m), ' minutes'), TimeFromNow < 2d, strcat(toint(TimeFromNow / 1h), ' hours'), strcat(toint(TimeFromNow / 1d), ' days')), ' ago')\r\n| project User = UserDisplayName, ['Sign-in Status'] = strcat(iff(SigninStatus == 'Success', '✔️', '❌'), ' ', SigninStatus), ['Sign-in Time'] = TimeAgo, App = AppDisplayName, ['Error code'] = errorCode, ['Result type'] = ResultType, ['Result signature'] = ResultSignature, ['Result description'] = ResultDescription, ['Conditional access policies'] = ConditionalAccessPolicies, ['Conditional access status'] = ConditionalAccessStatus, ['Operating system'] = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser, ['Country or region'] = LocationDetails.countryOrRegion, ['State'] = LocationDetails.state, ['City'] = LocationDetails.city, ['Time generated'] = TimeGenerated, Status, ['User principal name'] = UserPrincipalName\r\n\r\n",
        "size": 0,
        "title": "Stav přihlášení pro dané zařízení",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Sign-in Status",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true
              }
            },
            {
              "columnMatch": "App",
              "formatter": 5
            },
            {
              "columnMatch": "Error code",
              "formatter": 5
            },
            {
              "columnMatch": "Result type",
              "formatter": 5
            },
            {
              "columnMatch": "Result signature",
              "formatter": 5
            },
            {
              "columnMatch": "Result description",
              "formatter": 5
            },
            {
              "columnMatch": "Conditional access policies",
              "formatter": 5
            },
            {
              "columnMatch": "Conditional access status",
              "formatter": 5
            },
            {
              "columnMatch": "Operating system",
              "formatter": 5
            },
            {
              "columnMatch": "Browser",
              "formatter": 5
            },
            {
              "columnMatch": "Country or region",
              "formatter": 5
            },
            {
              "columnMatch": "State",
              "formatter": 5
            },
            {
              "columnMatch": "City",
              "formatter": 5
            },
            {
              "columnMatch": "Time generated",
              "formatter": 5
            },
            {
              "columnMatch": "Status",
              "formatter": 5
            },
            {
              "columnMatch": "User principal name",
              "formatter": 5
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "export_userPrincipalName",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "customWidth": "50",
      "name": "query - 25"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")  or 'all' in (\"{export_userPrincipalName}\")\r\n{LocationFilter} {StateFilter} {CityFilter} \r\n| summarize SuccessLogon = countif(ResultType == 0), FailedLogon = countif(ResultType != 0) by UserPrincipalName, Location, City = tostring(LocationDetails.city), state = tostring(LocationDetails.state), longitude = toreal(LocationDetails.geoCoordinates.longitude), latitude = toreal(LocationDetails.geoCoordinates.latitude)",
        "size": 0,
        "title": "Celková úspěšná přihlášení do cloudu za zvolené časové období",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "map",
        "mapSettings": {
          "locInfo": "CountryRegion",
          "locInfoColumn": "Location",
          "latitude": "latitude",
          "longitude": "longitude",
          "sizeSettings": "SuccessLogon",
          "sizeAggregation": "Sum",
          "labelSettings": "state",
          "legendMetric": "SuccessLogon",
          "numberOfMetrics": 100,
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "nodeColorField": "SuccessLogon",
            "colorAggregation": "Sum",
            "type": "heatmap",
            "heatmapPalette": "orange",
            "heatmapMin": 0,
            "heatmapMax": 1
          }
        }
      },
      "customWidth": "50",
      "name": "query - 14"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")  or 'all' in (\"{export_userPrincipalName}\")\r\n{LocationFilter} {StateFilter} {CityFilter} \r\n| summarize SuccessLogon = countif(ResultType == 0), FailedLogon = countif(ResultType != 0) by UserPrincipalName, Location, City = tostring(LocationDetails.city), state = tostring(LocationDetails.state), longitude = toreal(LocationDetails.geoCoordinates.longitude), latitude = toreal(LocationDetails.geoCoordinates.latitude)",
        "size": 0,
        "title": "Celková neúspěšná přihlášení do cloudu za zvolené časové období",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "map",
        "mapSettings": {
          "locInfo": "CountryRegion",
          "locInfoColumn": "Location",
          "sizeSettings": "FailedLogon",
          "sizeAggregation": "Sum",
          "labelSettings": "Location",
          "legendMetric": "FailedLogon",
          "numberOfMetrics": 100,
          "legendAggregation": "Sum",
          "itemColorSettings": {
            "nodeColorField": "FailedLogon",
            "colorAggregation": "Sum",
            "type": "heatmap",
            "heatmapPalette": "red",
            "heatmapMin": 1,
            "heatmapMax": 1
          }
        }
      },
      "customWidth": "50",
      "name": "query - 15"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| where ResultType == 0\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")  or 'all' in (\"{export_userPrincipalName}\")\r\n{LocationFilter} {StateFilter} {CityFilter} \r\n| summarize count() by UserPrincipalName, Location //, City = tostring(LocationDetails.city), state = tostring(LocationDetails.state)\r\n| evaluate pivot(Location, sum(count_))",
        "size": 0,
        "title": "Úspěšná přihlášení podle států",
        "timeContextFromParameter": "TimeRange",
        "exportFieldName": "UserPrincipalName",
        "exportParameterName": "export_success_auth",
        "exportDefaultValue": "all",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "^[A-Z]{2}",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "grayBlue",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "_Empty",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "grayBlue",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ],
          "rowLimit": 2000,
          "filter": true
        }
      },
      "name": "query - 16"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| where ResultType == 0\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_success_auth}\")  or 'all' in (\"{export_success_auth}\")\r\n{LocationFilter} {StateFilter} {CityFilter}\r\n| summarize count() by UserPrincipalName, IPAddress, Location, City = tostring(LocationDetails.city), state = tostring(LocationDetails.state)",
        "size": 0,
        "title": "Seznam IP adres a lokací, ze kterých byl přístup realizován výběrem filtru na konkrétní identitu",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "rowLimit": 1000,
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "export_success_auth",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "name": "query - 27"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| where ResultType != 0\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_userPrincipalName}\")  or 'all' in (\"{export_userPrincipalName}\")\r\n{LocationFilter} {StateFilter} {CityFilter} \r\n| summarize count() by UserPrincipalName, Location //, City = tostring(LocationDetails.city), state = tostring(LocationDetails.state)\r\n| evaluate pivot(Location, sum(count_))",
        "size": 0,
        "title": "Neúspěšná přihlášení podle států",
        "timeContextFromParameter": "TimeRange",
        "exportFieldName": "UserPrincipalName",
        "exportParameterName": "export_failed_auth",
        "exportDefaultValue": "all",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "^[A-Z]{2}",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "red",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "grayBlue",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "_Empty",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "0",
                    "representation": "red",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "0",
                    "representation": "grayBlue",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "blue",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ],
          "rowLimit": 2000,
          "filter": true
        }
      },
      "name": "query - 16 - Copy"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SigninLogs\r\n| where not(UserPrincipalName matches regex \"[0-9|a-z]{8}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{4}-[0-9|a-z]{12}\")\r\n| where ResultType != 0\r\n| extend AccountUPN = UserPrincipalName\r\n{SelectedUsersWithExcludeFilter:value}\r\n| where AccountUPN in(\"{export_failed_auth}\")  or 'all' in (\"{export_failed_auth}\")\r\n{LocationFilter} {StateFilter} {CityFilter}\r\n| summarize count() by UserPrincipalName, IPAddress, Location, City = tostring(LocationDetails.city), state = tostring(LocationDetails.state)",
        "size": 0,
        "title": "Seznam IP adres a lokací, ze kterých byl přístup realizován výběrem filtru na konkrétní identitu",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "rowLimit": 1000,
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "export_failed_auth",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "name": "query - 28"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityIncident\r\n| where Status != \"Closed\"\r\n| mv-expand AlertIds\r\n| extend AlertIds = tostring(AlertIds)\r\n| join kind=leftouter (\r\nSecurityAlert\r\n| extend SystemAlertId = tostring(SystemAlertId)\r\n| project TimeGenerated, AlertName, AlertSeverity, Status, Techniques, ProductName, Description, Entities,SystemAlertId\r\n) on $left.AlertIds == $right.SystemAlertId\r\n| where Entities has_any(\"{export_userPrincipalName}\")\r\n| extend assignedTo = iff(isempty(tostring(Owner.userPrincipalName)), \"Not assigned\", tostring(Owner.userPrincipalName))\r\n| summarize count() by Title, Severity, Status, assignedTo, ProviderName, FirstActivityTime, LastActivityTime, tostring(Comments), tostring(BookmarkIds), tostring(Tasks), tostring(Labels), Entities, tostring(AdditionalData)\r\n\r\n",
        "size": 0,
        "title": "Aktuální přehled neuzavřených alertů a incidentů vázaných na daného uživatele",
        "noDataMessage": "Nebyly nalezeny žádné neuzavřené alerty a incidenty pro danou entitu",
        "noDataMessageStyle": 3,
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Title",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "72.4286ch"
              }
            },
            {
              "columnMatch": "Severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Medium",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Low",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Info",
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev4",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "16.5ch"
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "New",
                    "representation": "Fired",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Closed",
                    "representation": "Resolved",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Active",
                    "representation": "pending",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "14.5ch"
              }
            },
            {
              "columnMatch": "assignedTo",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Not assigned",
                    "representation": "warning",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "35.1429ch"
              }
            },
            {
              "columnMatch": "ProviderName",
              "formatter": 5
            },
            {
              "columnMatch": "FirstActivityTime",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "24.8571ch"
              }
            },
            {
              "columnMatch": "LastActivityTime",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "25.1429ch"
              }
            },
            {
              "columnMatch": "Comments",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "13ch"
              }
            },
            {
              "columnMatch": "BookmarkIds",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "14ch"
              }
            },
            {
              "columnMatch": "Tasks",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "13ch"
              }
            },
            {
              "columnMatch": "Labels",
              "formatter": 5
            },
            {
              "columnMatch": "Entities",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "13ch"
              }
            },
            {
              "columnMatch": "AdditionalData",
              "formatter": 5
            },
            {
              "columnMatch": "count_",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "12ch"
              }
            },
            {
              "columnMatch": "AlertSeverity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Medium",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Low",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Informational",
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev4",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true
              }
            }
          ],
          "rowLimit": 1000,
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "export_userPrincipalName",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "name": "query - 29"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "SecurityIncident\r\n| where Status == \"Closed\"\r\n| mv-expand AlertIds\r\n| extend AlertIds = tostring(AlertIds)\r\n| join kind=leftouter (\r\nSecurityAlert\r\n| extend SystemAlertId = tostring(SystemAlertId)\r\n| project TimeGenerated, AlertName, AlertSeverity, Status, Techniques, ProductName, Description, Entities,SystemAlertId\r\n) on $left.AlertIds == $right.SystemAlertId\r\n| where Entities has_any(\"{export_userPrincipalName}\")\r\n| extend assignedTo = iff(isempty(tostring(Owner.userPrincipalName)), \"Not assigned\", tostring(Owner.userPrincipalName))\r\n| summarize count() by Title, Severity, assignedTo, FirstActivityTime, LastActivityTime, tostring(AdditionalData),Classification,ClassificationReason,ClassificationComment",
        "size": 0,
        "title": "Aktuální přehled uzavřených alertů a incidentů vázaných na daného uživatele",
        "noDataMessage": "Nebyly nalezeny žádné uzavřené alerty a incidenty pro danou entitu",
        "noDataMessageStyle": 3,
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Title",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "GenericDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "50ch"
              }
            },
            {
              "columnMatch": "Severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Medium",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Low",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Info",
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev4",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "13.8571ch"
              }
            },
            {
              "columnMatch": "assignedTo",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Not assigned",
                    "representation": "warning",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "35.1429ch"
              }
            },
            {
              "columnMatch": "FirstActivityTime",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "24.8571ch"
              }
            },
            {
              "columnMatch": "LastActivityTime",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "25.1429ch"
              }
            },
            {
              "columnMatch": "AdditionalData",
              "formatter": 5
            },
            {
              "columnMatch": "Classification",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "20ch"
              }
            },
            {
              "columnMatch": "ClassificationComment",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "61.5714ch"
              }
            },
            {
              "columnMatch": "ClassificationReason",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "27ch"
              }
            },
            {
              "columnMatch": "count_",
              "formatter": 5,
              "formatOptions": {
                "customColumnWidthSetting": "12ch"
              }
            },
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "New",
                    "representation": "Fired",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Closed",
                    "representation": "Resolved",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Active",
                    "representation": "pending",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "14.5ch"
              }
            },
            {
              "columnMatch": "ProviderName",
              "formatter": 5
            },
            {
              "columnMatch": "Comments",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "13ch"
              }
            },
            {
              "columnMatch": "BookmarkIds",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "14ch"
              }
            },
            {
              "columnMatch": "Tasks",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "13ch"
              }
            },
            {
              "columnMatch": "Labels",
              "formatter": 5
            },
            {
              "columnMatch": "Entities",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "13ch"
              }
            },
            {
              "columnMatch": "AlertSeverity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "Sev0",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Medium",
                    "representation": "Sev1",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Low",
                    "representation": "Sev2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Informational",
                    "representation": "Sev3",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "Sev4",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkLabel": "View",
                "linkIsContextBlade": true
              }
            }
          ],
          "rowLimit": 1000,
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "export_userPrincipalName",
        "comparison": "isNotEqualTo",
        "value": "all"
      },
      "name": "query - 29 - Copy"
    },
    {
      "type": 1,
      "content": {
        "json": "Copyright © 2023 Cyber Rangers s.r.o. All rights reserved.\r\n\r\nThe contents of this specific Azure Workbook, identified as \"Kontrola autentizací do cloudu\", are the property of Cyber Rangers s.r.o. and are protected under the copyright laws of the Czech Republic and other countries. Unauthorized use, reproduction, modification, distribution, or transmission of any part of this specific Azure Workbook without the prior written consent of Cyber Rangers s.r.o. is strictly prohibited.\r\n\r\nAzure is a registered trademark of Microsoft Corporation. Cyber Rangers s.r.o. is not affiliated with or endorsed by Microsoft Corporation.\r\n\r\nFor more information about Cyber Rangers s.r.o. and its products and services, please visit our website at https://www.cyber-rangers.com."
      },
      "name": "text - 26"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/b6a16c17-756e-4a65-8a04-a1791238d9a9/resourcegroups/rg_sentinel/providers/microsoft.operationalinsights/workspaces/wks-sentinel-we"
  ],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}